<!DOCTYPE html>
<html>
  <head>
  	<meta charset="UTF-8">
  	<title>RTP-TS-CALC</title>
  	<link rel="manifest" href="manifest.webmanifest">

    <link rel="icon" type="image/png" href="images/favicon.png" sizes="32x32">

    <link rel="stylesheet" href="librarys/dygraph/dygraph.css">

    <link rel="stylesheet" href="frameworks/spectre.min.css">
  	<link rel="stylesheet" href="frameworks/spectre-exp.min.css">
  	<link rel="stylesheet" href="frameworks/spectre-icons.min.css">

    <link rel="stylesheet" href="stylesheets/dragbox.css">
    <link rel="stylesheet" href="stylesheets/result_chart_modal.css">
    <link rel="stylesheet" href="stylesheets/layout.css">
    <link rel="stylesheet" href="stylesheets/results.css">
    <link rel="stylesheet" href="stylesheets/main.css">

  	<script src="frameworks/jquery-3.4.1.min.js"></script>
    <script src="librarys/showdown/showdown.min.js"></script>
    <script src="js/markdownConverter.js"></script>
  </head>
  <body>

    <div class="docu_content" style="width:50%; margin:auto;">
      <h1 > RTP TS Calculator Documentation </h1>


      <h3>
        <a name="rtpts"></a>
        RTP Timestamps
      </h3>
      RTP timestamps are part of the RTP protocol. Depending on what
      protocol used, the clock used to genereate the RTP timestamp has other
      frequencies.
      <br/>
      Example Clocks:

      <ul>
        <li>SMPTE ST-2110: 90kHz</li>
        <li>SMPTE ST-2022-6 : 27MHz</li>
      </ul>

      In the case of 2110 the timestamp-header has a size of 32Bit, so the
      highest possible value is 4294967296. Based on a 90kHz clock the
      timestamp will overflow after ca. 13,25h.

      <br/>

      The chart should show a linear line, like in this screenshot
    </div>

      <br/>
      <img src="./images/documentation/rtp_timestamps_good.png" class="img-responsive"/>
      <br/>

    <div class="docu_content" style="width:50%; margin:auto;">
      If stairs are visible, the sender has problems with its timestamping
      and thus creates bursty signals. Also for 2110: all RTP timestamps of a
      frame have to be equal! So the frame chart should show a peak of 1800
      ticks at the first packet, and after that zero for the rest of the frame.

      <h3>
        <a name="rects"></a>
        Receiver Timestamps
      </h3>

      There are two main ways of adding timestamps to a packet when it is
      received by a Receiver

      <ul>
        <li>Hardware timestamping</li>
        <li>Software timestamping</li>
      </ul>

      In hardware timestamping the network card can use a clock to directly
      timestamp a packet at its arrival and thus provide the best and most
      accurate timestamp possible. But not all NICs are supporting hardware
      timestamping

      With software timestamping the timestamps are generated by the operating
      system. They are usually not as accurate as the packet has to travel
      through the network stack first before it is timestamped, which could introduce
      jitter.

      <br/>
      The timestamps in a pcap file are written in seconds till the particular
      epoch with a temporal resolution of either nanoseconds or microseconds.
      For analysing 2110 streams, a nano seconds resolution is mandatory.

      The header size is 64 bit, 32 Bit for the seconds and 32Bit for the nano
      seconds. This makes it hard to analyze this timestamps with usual Software
      like Excel, as for example Excel only supports numbers up to 32Bit.
      The chart only shows the nanoseconds, as the seconds usually are not of interest.
      A good capture should look like This
      <br/>
    </div>

    <img
      src="./images/documentation/rec_timestamps_good.png"
      class="img-responsive"
    />

    <div class="docu_content" style="width:50%; margin:auto;">
      <br/>
      In this example the framerate of the video is 25, so the nanoseconds part
      of the timestamp will overflow after 25 frames.

      Looking at the frame chart, the values should also rise in a linear maner
      with no jumps or stairs in it. Below is an example of a bad capture,
      where the receiver struggled with the high amount of incomming packets.
    </div>

    <br/>
      <img src="./images/documentation/rec_timestamps_bad.png" class="img-responsive"/>
    <br/>

    <div class="docu_content" style="width:50%; margin:auto;">
      <h3>
        <a name="rtpoff"></a>
        RTP Timestamp Offset
      </h3>
      The RTP Timestamp Offsets are the difference between an RTP
      timestamp to its previous RTP timestamp. This should be useful to detect
      if the timestamping of the sender is correct. Below is an example of a
      good capture
    </div>
      <br/>
        <img src="./images/documentation/rtp_timestamp_offset_good.png"class="img-responsive" />
      <br/>
    <div class="docu_content" style="width:50%; margin:auto;">

      <h3>
        <a name="recoff"></a>
        Receiver Timestamp Offset
      </h3>

      This is just another representation of the receiver timestamps, where
      the difference between the current receiver timestamp to the previous
      timestamp is displayed. A good capture should show a straight horizontal
      line, so a constant offset to the previous packet.
    </div>

    <br/>
      <img src="./images/documentation/rec_timestamp_offset_good.png" class="img-responsive"/>
    <br/>

    <div class="docu_content" style="width:50%; margin:auto;">
      Packet loss results in a bigger delta, which could be one reason for a
      displayed peak.
      If gaps are visible, either the receiver is struggeling
      with recording the packets and is thus introducing jitter, or the
      jitter was introduced by the network itself.
      A bad capture will look like this:
    </div>
      <br/>
        <img src="./images/documentation/rec_timestamps_offset_bad.png" class="img-responsive" />
      <br/>
    <div class="docu_content" style="width:50%; margin:auto;">

      <h3>
        <a name="delta"></a>
        RTP-RX Timestamp Delta
      </h3>

      This values show how long each packet needed to get from the sender
      to the receiver. For this, the receiver timestamp first has to be
      converted into an absolute timestamp. Here is a very short explanation
      of the used algorithm:
      <ul>
        <li>
          Convert receiver timestamp into ticks
        </li>
        <li>
          Modulo the receiver timestamp in ticks through the size of the RTP
          timestamp header ( receiverTimestampTicks % 2^32 )
        </li>
        <li>
          Calculate the difference between this timestamp and the RTP timestamp
        </li>
    </ul>

    The resulting values should be somewhere under 1s. If the offset is around
    37s, the sending device is probably locked to UTC and not TAI (whereas the
    receiver is locked to TAI). If the offset  is somewhere around -37 seconds,
    the receiver is probably locked to UTC and the sender to TAI.

    <br/>
    The chart should show a straight horizontal line too. If the line is going
    up or down, the two devices are not in sync to each other. Here is an
    example of a good capture:
  </div>
    <br/>
      <img src="./images/documentation/delta_good.png" class="img-responsive"/>
    <br/>
  <div class="docu_content" style="width:50%; margin:auto;">

    And here is one of a bad capture
  </div>
    <br/>
      <img src="./images/documentation/delta_bad.png" class="img-responsive"/>
    <br/>




  </body>
</html>
